

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HamGNN_v_2_1.nn.embeddings &mdash; HamGNN v2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=7902463a" />

  
    <link rel="shortcut icon" href="../../../_static/logo.png"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=c36237e0"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=faab29de"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            HamGNN_v_2_1
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/index.html">HamGNN User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/introduction.html">HamGNN Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/introduction.html#key-features">Key Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/introduction.html#application-areas">Application Areas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/introduction.html#latest-developments">Latest Developments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/installation.html">Environment Configuration and Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/installation.html#python-environment">Python Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/installation.html#third-party-dft-tool-support">Third-party DFT Tool Support</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../user_guide/installation.html#openmx">OpenMX</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../user_guide/installation.html#siesta-honpas">SIESTA/HONPAS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../user_guide/installation.html#abacus">ABACUS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../user_guide/installation.html#compiling-openmx-postprocess-and-read-openmx">Compiling <code class="docutils literal notranslate"><span class="pre">openmx_postprocess</span></code> and <code class="docutils literal notranslate"><span class="pre">read_openmx</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/installation.html#hamgnn-installation-steps">HamGNN Installation Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../user_guide/installation.html#step-one-install-conda-environment">Step One: Install Conda Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../user_guide/installation.html#step-two-source-installation-of-hamgnn">Step Two: Source Installation of HamGNN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/data_preparation.html">Construction of graph_data.npz File</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/data_preparation.html#general-process">General Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/data_preparation.html#openmx-process">OpenMX Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/data_preparation.html#siesta-honpas-process">SIESTA/HONPAS Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/data_preparation.html#abacus-process">ABACUS Process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/training.html">Model Training Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/training.html#training-mode-classification">Training Mode Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/training.html#training-command">Training Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/training.html#key-configuration-items">Key Configuration Items</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/training.html#training-monitoring">Training Monitoring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/prediction.html">Model Prediction Operation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/prediction.html#preparation-for-prediction">Preparation for Prediction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/prediction.html#execute-prediction">Execute Prediction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/prediction.html#output-results">Output Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/band_calculation.html">Band Structure Calculation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/band_calculation.html#operation-process">Operation Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/band_calculation.html#band-calculation-for-large-systems">Band Calculation for Large Systems</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/uni_hamgnn.html">Uni-HamGNN Universal Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/uni_hamgnn.html#model-introduction">Model Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/uni_hamgnn.html#input-requirements">Input Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/uni_hamgnn.html#usage-process">Usage Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/uni_hamgnn.html#output-results">Output Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/parameters.html">HamGNN Parameter Details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/parameters.html#setup-basic-settings">setup (Basic Settings)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/parameters.html#dataset-params-dataset-parameters">dataset_params (Dataset Parameters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/parameters.html#losses-metrics-loss-functions-and-evaluation-metrics">losses_metrics (Loss Functions and Evaluation Metrics)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/parameters.html#optim-params-optimizer-parameters">optim_params (Optimizer Parameters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/parameters.html#output-nets-hamgnn-out-output-network-parameters">output_nets.HamGNN_out (Output Network Parameters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/parameters.html#representation-nets-hamgnn-pre-representation-network-parameters">representation_nets.HamGNN_pre (Representation Network Parameters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/parameters.html#parameter-adjustment-recommendations">Parameter Adjustment Recommendations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../user_guide/parameters.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/model_structure.html">Model Structure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_structure.html#module-HamGNN_v_2_1.models.base_model">Base Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.base_model.get_radii_from_atomic_numbers"><code class="docutils literal notranslate"><span class="pre">get_radii_from_atomic_numbers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.base_model.neighbor_list_and_relative_vec"><code class="docutils literal notranslate"><span class="pre">neighbor_list_and_relative_vec()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.base_model.find_matching_columns_of_A_in_B"><code class="docutils literal notranslate"><span class="pre">find_matching_columns_of_A_in_B()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.base_model.BaseModel"><code class="docutils literal notranslate"><span class="pre">BaseModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.base_model.BaseModel.forward"><code class="docutils literal notranslate"><span class="pre">BaseModel.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.base_model.BaseModel.generate_graph"><code class="docutils literal notranslate"><span class="pre">BaseModel.generate_graph()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.base_model.BaseModel.num_params"><code class="docutils literal notranslate"><span class="pre">BaseModel.num_params</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_structure.html#module-HamGNN_v_2_1.models.hamgnn_conv">HamGNN Convolution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_conv.HamGNNConvE3"><code class="docutils literal notranslate"><span class="pre">HamGNNConvE3</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_conv.HamGNNConvE3.forward"><code class="docutils literal notranslate"><span class="pre">HamGNNConvE3.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_structure.html#module-HamGNN_v_2_1.models.hamgnn_transformer">HamGNN Transformer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_transformer.HamGNNTransformer"><code class="docutils literal notranslate"><span class="pre">HamGNNTransformer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_transformer.HamGNNTransformer.forward"><code class="docutils literal notranslate"><span class="pre">HamGNNTransformer.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_structure.html#module-HamGNN_v_2_1.models.hamgnn_output">HamGNN Output Head</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamLayer"><code class="docutils literal notranslate"><span class="pre">HamLayer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamLayer.forward"><code class="docutils literal notranslate"><span class="pre">HamLayer.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.merge_tensor_components"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.merge_tensor_components()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.merge_rank2_tensor_components"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.merge_rank2_tensor_components()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.merge_rank0_tensor_components"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.merge_rank0_tensor_components()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.construct_j_coupling_matrix"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.construct_j_coupling_matrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.construct_k_coupling_matrix"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.construct_k_coupling_matrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.reorder_matrix"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.reorder_matrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.construct_molecular_hamiltonian"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.construct_molecular_hamiltonian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.concatenate_hamiltonians_by_crystal"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.concatenate_hamiltonians_by_crystal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.symmetrize_hamiltonian"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.symmetrize_hamiltonian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.symmetrize_onsite_hamiltonian"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.symmetrize_onsite_hamiltonian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.symmetrize_offsite_hamiltonian"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.symmetrize_offsite_hamiltonian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.symmetrize_onsite_hamiltonian_soc"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.symmetrize_onsite_hamiltonian_soc()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.symmetrize_offsite_hamiltonian_soc"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.symmetrize_offsite_hamiltonian_soc()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.calculate_band_energies_with_overlap"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.calculate_band_energies_with_overlap()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.calculate_band_energies"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.calculate_band_energies()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.calculate_band_energies_with_spin_orbit_coupling"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.calculate_band_energies_with_spin_orbit_coupling()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.apply_orbital_masks_to_hamiltonians"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.apply_orbital_masks_to_hamiltonians()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.symmetrize_orbital_coefficients"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.symmetrize_orbital_coefficients()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.create_cell_index_mapping"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.create_cell_index_mapping()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.extract_unique_cell_vectors"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.extract_unique_cell_vectors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.build_edge_lookup_structures"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.build_edge_lookup_structures()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.create_orbital_validity_mask"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.create_orbital_validity_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.build_interaction_masks"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.build_interaction_masks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.build_column_wise_interaction_masks"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.build_column_wise_interaction_masks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.build_spin_orbit_interaction_masks"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.build_spin_orbit_interaction_masks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.calculate_sparsity_ratio"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.calculate_sparsity_ratio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.validate_elements_in_basis_def"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.validate_elements_in_basis_def()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.hamgnn_output.HamGNNPlusPlusOut.forward"><code class="docutils literal notranslate"><span class="pre">HamGNNPlusPlusOut.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_structure.html#module-HamGNN_v_2_1.models.Model">Main Model Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model"><code class="docutils literal notranslate"><span class="pre">Model</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.calculate_loss"><code class="docutils literal notranslate"><span class="pre">Model.calculate_loss()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.training_step"><code class="docutils literal notranslate"><span class="pre">Model.training_step()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.validation_step"><code class="docutils literal notranslate"><span class="pre">Model.validation_step()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.validation_epoch_end"><code class="docutils literal notranslate"><span class="pre">Model.validation_epoch_end()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.test_step"><code class="docutils literal notranslate"><span class="pre">Model.test_step()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.test_epoch_end"><code class="docutils literal notranslate"><span class="pre">Model.test_epoch_end()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.forward"><code class="docutils literal notranslate"><span class="pre">Model.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.log_metrics"><code class="docutils literal notranslate"><span class="pre">Model.log_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_structure.html#HamGNN_v_2_1.models.Model.Model.configure_optimizers"><code class="docutils literal notranslate"><span class="pre">Model.configure_optimizers()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gnn_core.html">GNN Core Layers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gnn_core/message_passing.html">Message Passing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/message_passing.html#module-HamGNN_v_2_1.nn.message_passing">Message Pack Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/message_passing.html#HamGNN_v_2_1.nn.message_passing.MessagePackBlock"><code class="docutils literal notranslate"><span class="pre">MessagePackBlock</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/message_passing.html#HamGNN_v_2_1.nn.message_passing.MessagePackBlockV2"><code class="docutils literal notranslate"><span class="pre">MessagePackBlockV2</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gnn_core/attention.html">Attention Mechanisms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/attention.html#module-HamGNN_v_2_1.nn.attention">Attention Layers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/attention.html#HamGNN_v_2_1.nn.attention.AttentionAggregationV2"><code class="docutils literal notranslate"><span class="pre">AttentionAggregationV2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/attention.html#HamGNN_v_2_1.nn.attention.AttentionAggregation"><code class="docutils literal notranslate"><span class="pre">AttentionAggregation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/attention.html#HamGNN_v_2_1.nn.attention.AttentionBlockE3"><code class="docutils literal notranslate"><span class="pre">AttentionBlockE3</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/attention.html#module-HamGNN_v_2_1.nn.attention_utils">Attention Utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/attention.html#HamGNN_v_2_1.nn.attention_utils.VectorToAttentionHeads"><code class="docutils literal notranslate"><span class="pre">VectorToAttentionHeads</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/attention.html#HamGNN_v_2_1.nn.attention_utils.AttentionHeadsToVector"><code class="docutils literal notranslate"><span class="pre">AttentionHeadsToVector</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gnn_core/convolution.html">Convolution Layers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/convolution.html#module-HamGNN_v_2_1.nn.convolution">Graph Convolution Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/convolution.html#HamGNN_v_2_1.nn.convolution.ConvBlockE3"><code class="docutils literal notranslate"><span class="pre">ConvBlockE3</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gnn_core/tensor_operations.html">Tensor Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/tensor_operations.html#module-HamGNN_v_2_1.nn.tensor_products">Tensor Products</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/tensor_operations.html#HamGNN_v_2_1.nn.tensor_products.LinearScaleWithWeights"><code class="docutils literal notranslate"><span class="pre">LinearScaleWithWeights</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/tensor_operations.html#HamGNN_v_2_1.nn.tensor_products.TensorProductWithMemoryOptimizationWithWeight"><code class="docutils literal notranslate"><span class="pre">TensorProductWithMemoryOptimizationWithWeight</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/tensor_operations.html#HamGNN_v_2_1.nn.tensor_products.TensorProductWithScalarComponents"><code class="docutils literal notranslate"><span class="pre">TensorProductWithScalarComponents</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/tensor_operations.html#HamGNN_v_2_1.nn.tensor_products.ConcatenatedIrrepsTensorProduct"><code class="docutils literal notranslate"><span class="pre">ConcatenatedIrrepsTensorProduct</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gnn_core/interaction_blocks.html">Interaction Blocks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/interaction_blocks.html#module-HamGNN_v_2_1.nn.interaction_blocks">Neural Network Interaction Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/interaction_blocks.html#HamGNN_v_2_1.nn.interaction_blocks.PairInteractionBlock"><code class="docutils literal notranslate"><span class="pre">PairInteractionBlock</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/interaction_blocks.html#HamGNN_v_2_1.nn.interaction_blocks.CorrProductBlock"><code class="docutils literal notranslate"><span class="pre">CorrProductBlock</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/interaction_blocks.html#HamGNN_v_2_1.nn.interaction_blocks.ResidualBlock"><code class="docutils literal notranslate"><span class="pre">ResidualBlock</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html">Physics Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#module-HamGNN_v_2_1.physics.Clebsch_Gordan_coefficients">Clebsch-Gordan Coefficients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.Clebsch_Gordan_coefficients.ClebschGordanCoefficients"><code class="docutils literal notranslate"><span class="pre">ClebschGordanCoefficients</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#module-HamGNN_v_2_1.physics.kpoints">K-Points</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.kpoints.kpoints_generator"><code class="docutils literal notranslate"><span class="pre">kpoints_generator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.kpoints.compute_reciprocal_lattice_vectors"><code class="docutils literal notranslate"><span class="pre">compute_reciprocal_lattice_vectors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.kpoints.generate_kpoint_grid"><code class="docutils literal notranslate"><span class="pre">generate_kpoint_grid()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#module-HamGNN_v_2_1.physics.matrix_operations">Matrix Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.matrix_operations.HamLayer"><code class="docutils literal notranslate"><span class="pre">HamLayer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.matrix_operations.TensorExpansion"><code class="docutils literal notranslate"><span class="pre">TensorExpansion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.matrix_operations.OverlapExpand"><code class="docutils literal notranslate"><span class="pre">OverlapExpand</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/gnn_core/physics_tools.html#HamGNN_v_2_1.physics.matrix_operations.TensorMerge"><code class="docutils literal notranslate"><span class="pre">TensorMerge</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/model_components.html">Model Components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.nn.embeddings">Embeddings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.RadialBasisEdgeEncoding"><code class="docutils literal notranslate"><span class="pre">RadialBasisEdgeEncoding</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.RadialBasisEdgeEncoding.out_field"><code class="docutils literal notranslate"><span class="pre">RadialBasisEdgeEncoding.out_field</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.RadialBasisEdgeEncoding.forward"><code class="docutils literal notranslate"><span class="pre">RadialBasisEdgeEncoding.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.EdgeScalarEmbedding"><code class="docutils literal notranslate"><span class="pre">EdgeScalarEmbedding</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.EdgeScalarEmbedding.forward"><code class="docutils literal notranslate"><span class="pre">EdgeScalarEmbedding.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.LocalEnvironmentEmbedding"><code class="docutils literal notranslate"><span class="pre">LocalEnvironmentEmbedding</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.LocalEnvironmentEmbedding.forward"><code class="docutils literal notranslate"><span class="pre">LocalEnvironmentEmbedding.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock"><code class="docutils literal notranslate"><span class="pre">PairInteractionEmbeddingBlock</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.create_linear"><code class="docutils literal notranslate"><span class="pre">PairInteractionEmbeddingBlock.create_linear()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.create_tensor_product"><code class="docutils literal notranslate"><span class="pre">PairInteractionEmbeddingBlock.create_tensor_product()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.init_weight_generator"><code class="docutils literal notranslate"><span class="pre">PairInteractionEmbeddingBlock.init_weight_generator()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.forward"><code class="docutils literal notranslate"><span class="pre">PairInteractionEmbeddingBlock.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.Embedding"><code class="docutils literal notranslate"><span class="pre">Embedding</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.Embedding.reset_parameters"><code class="docutils literal notranslate"><span class="pre">Embedding.reset_parameters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.Embedding.forward"><code class="docutils literal notranslate"><span class="pre">Embedding.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.nn.electron_configurations">Electron Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.utils.mlp">MLP Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.mlp.linear_bn_act"><code class="docutils literal notranslate"><span class="pre">linear_bn_act()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.mlp.denseLayer"><code class="docutils literal notranslate"><span class="pre">denseLayer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.mlp.denseLayer.forward"><code class="docutils literal notranslate"><span class="pre">denseLayer.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.mlp.Dense"><code class="docutils literal notranslate"><span class="pre">Dense</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.mlp.Dense.reset_parameters"><code class="docutils literal notranslate"><span class="pre">Dense.reset_parameters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.mlp.Dense.forward"><code class="docutils literal notranslate"><span class="pre">Dense.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.utils.activation">Activation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.shifted_softplus"><code class="docutils literal notranslate"><span class="pre">shifted_softplus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.switch_function"><code class="docutils literal notranslate"><span class="pre">switch_function()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.softplus_inverse"><code class="docutils literal notranslate"><span class="pre">softplus_inverse()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SoftUnitStepCutoff"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SoftUnitStepCutoff.cutoff"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff.cutoff</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SoftUnitStepCutoff.cut_param"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff.cut_param</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SoftUnitStepCutoff.forward"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.swish"><code class="docutils literal notranslate"><span class="pre">swish()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SSP"><code class="docutils literal notranslate"><span class="pre">SSP</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SSP.forward"><code class="docutils literal notranslate"><span class="pre">SSP.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SSP.extra_repr"><code class="docutils literal notranslate"><span class="pre">SSP.extra_repr()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SWISH"><code class="docutils literal notranslate"><span class="pre">SWISH</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.SWISH.forward"><code class="docutils literal notranslate"><span class="pre">SWISH.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.activation.get_activation"><code class="docutils literal notranslate"><span class="pre">get_activation()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.utils.basis_functions">Basis Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.BernsteinRadialBasisFunctions"><code class="docutils literal notranslate"><span class="pre">BernsteinRadialBasisFunctions</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.BernsteinRadialBasisFunctions.reset_parameters"><code class="docutils literal notranslate"><span class="pre">BernsteinRadialBasisFunctions.reset_parameters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.BernsteinRadialBasisFunctions.forward"><code class="docutils literal notranslate"><span class="pre">BernsteinRadialBasisFunctions.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.ExponentialBernsteinRadialBasisFunctions"><code class="docutils literal notranslate"><span class="pre">ExponentialBernsteinRadialBasisFunctions</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.ExponentialBernsteinRadialBasisFunctions.reset_parameters"><code class="docutils literal notranslate"><span class="pre">ExponentialBernsteinRadialBasisFunctions.reset_parameters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.ExponentialBernsteinRadialBasisFunctions.forward"><code class="docutils literal notranslate"><span class="pre">ExponentialBernsteinRadialBasisFunctions.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.ExponentialGaussianRadialBasisFunctions"><code class="docutils literal notranslate"><span class="pre">ExponentialGaussianRadialBasisFunctions</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.ExponentialGaussianRadialBasisFunctions.reset_parameters"><code class="docutils literal notranslate"><span class="pre">ExponentialGaussianRadialBasisFunctions.reset_parameters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.ExponentialGaussianRadialBasisFunctions.forward"><code class="docutils literal notranslate"><span class="pre">ExponentialGaussianRadialBasisFunctions.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.GaussianRadialBasisFunctions"><code class="docutils literal notranslate"><span class="pre">GaussianRadialBasisFunctions</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.GaussianRadialBasisFunctions.reset_parameters"><code class="docutils literal notranslate"><span class="pre">GaussianRadialBasisFunctions.reset_parameters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.GaussianRadialBasisFunctions.forward"><code class="docutils literal notranslate"><span class="pre">GaussianRadialBasisFunctions.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.OverlapBernsteinRadialBasisFunctions"><code class="docutils literal notranslate"><span class="pre">OverlapBernsteinRadialBasisFunctions</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.OverlapBernsteinRadialBasisFunctions.reset_parameters"><code class="docutils literal notranslate"><span class="pre">OverlapBernsteinRadialBasisFunctions.reset_parameters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.OverlapBernsteinRadialBasisFunctions.forward"><code class="docutils literal notranslate"><span class="pre">OverlapBernsteinRadialBasisFunctions.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.sph_harm_layer"><code class="docutils literal notranslate"><span class="pre">sph_harm_layer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.sph_harm_layer.forward"><code class="docutils literal notranslate"><span class="pre">sph_harm_layer.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.BesselBasis"><code class="docutils literal notranslate"><span class="pre">BesselBasis</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.BesselBasis.forward"><code class="docutils literal notranslate"><span class="pre">BesselBasis.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.GaussianSmearing"><code class="docutils literal notranslate"><span class="pre">GaussianSmearing</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.basis_functions.GaussianSmearing.forward"><code class="docutils literal notranslate"><span class="pre">GaussianSmearing.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.utils.cutoff_functions">Cutoff Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.cutoff_function"><code class="docutils literal notranslate"><span class="pre">cutoff_function()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.cuttoff_envelope"><code class="docutils literal notranslate"><span class="pre">cuttoff_envelope</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.cuttoff_envelope.forward"><code class="docutils literal notranslate"><span class="pre">cuttoff_envelope.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.CosineCutoff"><code class="docutils literal notranslate"><span class="pre">CosineCutoff</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.CosineCutoff.forward"><code class="docutils literal notranslate"><span class="pre">CosineCutoff.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.SoftUnitStepCutoff"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.SoftUnitStepCutoff.cutoff"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff.cutoff</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.SoftUnitStepCutoff.cut_param"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff.cut_param</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.cutoff_functions.SoftUnitStepCutoff.forward"><code class="docutils literal notranslate"><span class="pre">SoftUnitStepCutoff.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.utils.regression_layers">Regression Layers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.regression_layers.denseRegression"><code class="docutils literal notranslate"><span class="pre">denseRegression</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.regression_layers.denseRegression.forward"><code class="docutils literal notranslate"><span class="pre">denseRegression.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.regression_layers.MLPRegression"><code class="docutils literal notranslate"><span class="pre">MLPRegression</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.regression_layers.MLPRegression.forward"><code class="docutils literal notranslate"><span class="pre">MLPRegression.forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/model_components.html#module-HamGNN_v_2_1.utils.hparam">Hyperparameter Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/model_components.html#HamGNN_v_2_1.utils.hparam.get_hparam_dict"><code class="docutils literal notranslate"><span class="pre">get_hparam_dict()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/data_processing.html">Data Processing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_processing.html#graph-data">Graph Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/configuration.html#module-HamGNN_v_2_1.config.config_parsing">Config Parsing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/configuration.html#HamGNN_v_2_1.config.config_parsing.config_default"><code class="docutils literal notranslate"><span class="pre">config_default</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/configuration.html#HamGNN_v_2_1.config.config_parsing.recursive_update"><code class="docutils literal notranslate"><span class="pre">recursive_update()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/configuration.html#HamGNN_v_2_1.config.config_parsing.load_config"><code class="docutils literal notranslate"><span class="pre">load_config()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/utilities.html">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/utilities.html#module-HamGNN_v_2_1.utils.irreps_utils">Irreps Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.irreps_utils.extract_scalar_irreps"><code class="docutils literal notranslate"><span class="pre">extract_scalar_irreps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.irreps_utils.irreps2gate"><code class="docutils literal notranslate"><span class="pre">irreps2gate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.irreps_utils.scale_irreps"><code class="docutils literal notranslate"><span class="pre">scale_irreps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.irreps_utils.filter_and_split_irreps"><code class="docutils literal notranslate"><span class="pre">filter_and_split_irreps()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/utilities.html#module-HamGNN_v_2_1.utils.triplets">Triplets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.triplets.triplets"><code class="docutils literal notranslate"><span class="pre">triplets()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/utilities.html#module-HamGNN_v_2_1.utils.math_utils">Math Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.math_utils.count_neighbors_per_node"><code class="docutils literal notranslate"><span class="pre">count_neighbors_per_node()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.math_utils.prod"><code class="docutils literal notranslate"><span class="pre">prod()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.math_utils.blockwise_2x2_concat"><code class="docutils literal notranslate"><span class="pre">blockwise_2x2_concat()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.math_utils.extract_elements_above_threshold"><code class="docutils literal notranslate"><span class="pre">extract_elements_above_threshold()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.math_utils.upgrade_tensor_precision"><code class="docutils literal notranslate"><span class="pre">upgrade_tensor_precision()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/utilities.html#module-HamGNN_v_2_1.utils.losses">Loss Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.cosine_similarity_loss"><code class="docutils literal notranslate"><span class="pre">cosine_similarity_loss</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.cosine_similarity_loss.forward"><code class="docutils literal notranslate"><span class="pre">cosine_similarity_loss.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.sum_zero_loss"><code class="docutils literal notranslate"><span class="pre">sum_zero_loss</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.sum_zero_loss.forward"><code class="docutils literal notranslate"><span class="pre">sum_zero_loss.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.Euclidean_loss"><code class="docutils literal notranslate"><span class="pre">Euclidean_loss</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.Euclidean_loss.forward"><code class="docutils literal notranslate"><span class="pre">Euclidean_loss.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.RMSELoss"><code class="docutils literal notranslate"><span class="pre">RMSELoss</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.RMSELoss.forward"><code class="docutils literal notranslate"><span class="pre">RMSELoss.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.losses.parse_metric_func"><code class="docutils literal notranslate"><span class="pre">parse_metric_func()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/utilities.html#module-HamGNN_v_2_1.utils.visualization">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utilities.html#HamGNN_v_2_1.utils.visualization.scatter_plot"><code class="docutils literal notranslate"><span class="pre">scatter_plot()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">HamGNN_v_2_1</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">HamGNN_v_2_1.nn.embeddings</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for HamGNN_v_2_1.nn.embeddings</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">e3nn</span><span class="w"> </span><span class="kn">import</span> <span class="n">o3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">e3nn.nn</span><span class="w"> </span><span class="kn">import</span> <span class="n">FullyConnectedNet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">e3nn.util.jit</span><span class="w"> </span><span class="kn">import</span> <span class="n">compile_mode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..toolbox.efficient_kan</span><span class="w"> </span><span class="kn">import</span> <span class="n">KAN</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..toolbox.nequip.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">AtomicDataDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..toolbox.nequip.nn</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphModuleMixin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..utils.macro</span><span class="w"> </span><span class="kn">import</span> <span class="n">GRID_RANGE</span><span class="p">,</span> <span class="n">GRID_SIZE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.electron_configurations</span><span class="w"> </span><span class="kn">import</span> <span class="n">electron_configurations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.tensor_products</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorProductWithMemoryOptimizationWithWeight</span>

<div class="viewcode-block" id="RadialBasisEdgeEncoding">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.RadialBasisEdgeEncoding">[docs]</a>
<span class="nd">@compile_mode</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RadialBasisEdgeEncoding</span><span class="p">(</span><span class="n">GraphModuleMixin</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encodes edge lengths using a specified radial basis.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        out_field (str): The key for storing the encoded edge features.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">out_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">EDGE_EMBEDDING_KEY</span><span class="p">,</span>
        <span class="n">irreps_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the RadialBasisEdgeEncoding module.</span>

<span class="sd">        :param basis: The radial basis function used for encoding.</span>
<span class="sd">        :param out_field: The output field key for encoded edges.</span>
<span class="sd">        :param irreps_in: Input irreducible representations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_field</span> <span class="o">=</span> <span class="n">out_field</span>

        <span class="c1"># Determine the number of basis functions based on the basis type</span>
        <span class="n">basis_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">basis_type</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;BesselBasis&#39;</span><span class="p">,</span> <span class="s1">&#39;GaussianSmearing&#39;</span><span class="p">}:</span>
            <span class="n">num_basis</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">basis_type</span> <span class="o">==</span> <span class="s1">&#39;BesselBasis&#39;</span> <span class="k">else</span> <span class="n">basis</span><span class="o">.</span><span class="n">offset</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">basis_type</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s1">&#39;ExponentialGaussianRadialBasisFunctions&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ExponentialBernsteinRadialBasisFunctions&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GaussianRadialBasisFunctions&#39;</span><span class="p">,</span>
            <span class="s1">&#39;BernsteinRadialBasisFunctions&#39;</span>
        <span class="p">}:</span>
            <span class="n">num_basis</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">num_basis_functions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Basis type </span><span class="si">{</span><span class="n">basis_type</span><span class="si">}</span><span class="s2"> is not supported.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_irreps</span><span class="p">(</span>
            <span class="n">irreps_in</span><span class="o">=</span><span class="n">irreps_in</span><span class="p">,</span>
            <span class="n">irreps_out</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_field</span><span class="p">:</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">([(</span><span class="n">num_basis</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))])},</span>
        <span class="p">)</span>

<div class="viewcode-block" id="RadialBasisEdgeEncoding.forward">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.RadialBasisEdgeEncoding.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">Type</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the edge encoding and updates the data dictionary.</span>

<span class="sd">        :param data: A dictionary containing graph data.</span>
<span class="sd">        :return: Updated graph data with encoded edge features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">edge_index</span>
        <span class="n">nbr_shift</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">nbr_shift</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pos</span>

        <span class="c1"># Calculate edge directions and lengths</span>
        <span class="n">edge_dir</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">nbr_shift</span><span class="p">)</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">edge_length</span> <span class="o">=</span> <span class="n">edge_dir</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Update data with computed edge vectors and lengths</span>
        <span class="n">data</span><span class="p">[</span><span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">EDGE_VECTORS_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_dir</span><span class="o">/</span><span class="n">edge_length</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">EDGE_LENGTH_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_length</span>

        <span class="c1"># Apply the radial basis to the edge lengths</span>
        <span class="n">edge_length_embedded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">(</span><span class="n">edge_length</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edge_length_embedded</span> <span class="o">=</span> <span class="n">edge_length_embedded</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">(</span><span class="n">edge_length</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
            
        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_length_embedded</span>

        <span class="k">return</span> <span class="n">data</span></div>
</div>



<div class="viewcode-block" id="EdgeScalarEmbedding">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.EdgeScalarEmbedding">[docs]</a>
<span class="nd">@compile_mode</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EdgeScalarEmbedding</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A layer to compute edge scalars from node attributes and edge embeddings.</span>

<span class="sd">    Args:</span>
<span class="sd">        irreps_node_attrs (Irreps): Irreps for node attributes.</span>
<span class="sd">        irreps_edge_embed (Irreps): Irreps for edge embeddings.</span>
<span class="sd">        irreps_edge_scalars (Irreps): Irreps for edge scalars.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irreps_node_attrs</span><span class="p">,</span> <span class="n">irreps_edge_embed</span><span class="p">,</span> <span class="n">irreps_edge_scalars</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_out</span> <span class="o">=</span> <span class="n">o3</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
            <span class="n">irreps_node_attrs</span> <span class="o">+</span> <span class="n">irreps_node_attrs</span> <span class="o">+</span> <span class="n">irreps_edge_embed</span><span class="p">,</span> <span class="n">irreps_edge_scalars</span>
        <span class="p">)</span>
        
<div class="viewcode-block" id="EdgeScalarEmbedding.forward">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.EdgeScalarEmbedding.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_attr_src</span><span class="p">,</span> <span class="n">node_attr_dst</span><span class="p">,</span> <span class="n">edge_embed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Forward pass to compute edge scalars.</span>

<span class="sd">        Args:</span>
<span class="sd">            node_attr_src (Tensor): Source node attributes.</span>
<span class="sd">            node_attr_dst (Tensor): Destination node attributes.</span>
<span class="sd">            edge_embed (Tensor): Edge embeddings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tensor: Computed edge scalars.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">combined_features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">node_attr_src</span><span class="p">,</span> <span class="n">node_attr_dst</span><span class="p">,</span> <span class="n">edge_embed</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_out</span><span class="p">(</span><span class="n">combined_features</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="LocalEnvironmentEmbedding">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.LocalEnvironmentEmbedding">[docs]</a>
<span class="nd">@compile_mode</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LocalEnvironmentEmbedding</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Embeds local environments using node and edge attributes, edge embeddings, and spherical harmonics.</span>

<span class="sd">    Args:</span>
<span class="sd">        irreps_edge_attrs (Irreps): Irreps for edge attributes.</span>
<span class="sd">        irreps_edge_embed (Irreps): Irreps for edge embeddings.</span>
<span class="sd">        irreps_node_attrs (Irreps): Irreps for node attributes.</span>
<span class="sd">        irreps_edge_scalars (Irreps): Irreps for edge scalars.</span>
<span class="sd">        irreps_env_sh (Irreps): Irreps for environment spherical harmonics.</span>
<span class="sd">        radial_mlp_dims (list[int]): Dimensions for the radial MLP.</span>
<span class="sd">        use_kan (bool): Whether to use the KAN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irreps_edge_attrs</span><span class="p">,</span> <span class="n">irreps_edge_embed</span><span class="p">,</span> <span class="n">irreps_node_attrs</span><span class="p">,</span>
                 <span class="n">irreps_edge_scalars</span><span class="p">,</span> <span class="n">irreps_env_sh</span><span class="p">,</span> <span class="n">radial_MLP</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">],</span> <span class="n">use_kan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edge_scalar_layer</span> <span class="o">=</span> <span class="n">EdgeScalarEmbedding</span><span class="p">(</span><span class="n">irreps_node_attrs</span><span class="p">,</span> <span class="n">irreps_edge_embed</span><span class="p">,</span> <span class="n">irreps_edge_scalars</span><span class="p">)</span>
        
        <span class="n">instructions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;uvw&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irreps_edge_attrs</span><span class="p">))]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tensor_product</span> <span class="o">=</span> <span class="n">o3</span><span class="o">.</span><span class="n">TensorProduct</span><span class="p">(</span>
            <span class="n">irreps_edge_attrs</span><span class="p">,</span>
            <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">(</span><span class="s1">&#39;1x0e&#39;</span><span class="p">),</span>
            <span class="n">irreps_env_sh</span><span class="p">,</span>
            <span class="n">instructions</span><span class="o">=</span><span class="n">instructions</span><span class="p">,</span>
            <span class="n">shared_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">internal_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">weight_numel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensor_product</span><span class="o">.</span><span class="n">weight_numel</span>

        <span class="n">input_dim</span> <span class="o">=</span> <span class="n">irreps_edge_embed</span><span class="o">.</span><span class="n">num_irreps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_weight_generator</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_numel</span><span class="p">,</span> <span class="n">radial_MLP</span><span class="p">,</span> <span class="n">use_kan</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_weight_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">weight_numel</span><span class="p">,</span> <span class="n">radial_MLP</span><span class="p">,</span> <span class="n">use_kan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the weight generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_dim (int): Input dimension for the generator.</span>
<span class="sd">            weight_numel (int): Number of elements in weights.</span>
<span class="sd">            radial_mlp_dims (list[int]): Dimensions for the radial MLP.</span>
<span class="sd">            use_kan (bool): Whether to use the KAN model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            nn.Module: The weight generator model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">use_kan</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">KAN</span><span class="p">([</span><span class="n">input_dim</span><span class="p">]</span> <span class="o">+</span> <span class="n">radial_MLP</span> <span class="o">+</span> <span class="p">[</span><span class="n">weight_numel</span><span class="p">],</span> <span class="n">grid_size</span><span class="o">=</span><span class="n">GRID_SIZE</span><span class="p">,</span> <span class="n">grid_range</span><span class="o">=</span><span class="n">GRID_RANGE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FullyConnectedNet</span><span class="p">(</span>
            <span class="p">[</span><span class="n">input_dim</span><span class="p">]</span> <span class="o">+</span> <span class="n">radial_MLP</span> <span class="o">+</span> <span class="p">[</span><span class="n">weight_numel</span><span class="p">],</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">silu</span><span class="p">,</span>
        <span class="p">)</span>
        
<div class="viewcode-block" id="LocalEnvironmentEmbedding.forward">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.LocalEnvironmentEmbedding.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">node_attr</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">edge_embed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Forward pass to compute local environment embeddings.</span>

<span class="sd">        Args:</span>
<span class="sd">            edge_index (Tensor): Indices of the edges.</span>
<span class="sd">            node_attr (Tensor): Node attributes.</span>
<span class="sd">            edge_attr (Tensor): Edge attributes.</span>
<span class="sd">            edge_embed (Tensor): Edge embeddings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tensor: Local environment embeddings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">edge_index</span>
        <span class="n">pseudo_scalar</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">edge_embed</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">edge_scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_scalar_layer</span><span class="p">(</span><span class="n">node_attr</span><span class="p">[</span><span class="n">src</span><span class="p">],</span> <span class="n">node_attr</span><span class="p">[</span><span class="n">dst</span><span class="p">],</span> <span class="n">edge_embed</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_generator</span><span class="p">(</span><span class="n">edge_scalars</span><span class="p">)</span>
        <span class="n">local_env_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">edge_attr</span><span class="p">,</span> <span class="n">pseudo_scalar</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">local_env_edge</span></div>
</div>



<div class="viewcode-block" id="PairInteractionEmbeddingBlock">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock">[docs]</a>
<span class="nd">@compile_mode</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PairInteractionEmbeddingBlock</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A pair interaction block for updating edge features based on node features and edge attributes.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - irreps_node_feats (o3.Irreps): Irreducible representations for node features.</span>
<span class="sd">    - irreps_edge_attrs (o3.Irreps): Irreducible representations for edge attributes.</span>
<span class="sd">    - irreps_edge_embed (o3.Irreps): Irreducible representations for edge embeddings.</span>
<span class="sd">    - irreps_edge_feats (o3.Irreps): Irreducible representations for edge features.</span>
<span class="sd">    - use_skip_connections (bool): Whether to use skip connections.</span>
<span class="sd">    - use_kan (bool): Whether to use KAN for radial MLP.</span>
<span class="sd">    - radial_MLP (Optional[List[int]]): Architecture of the radial MLP.</span>
<span class="sd">    - nonlinearity_type (str): Type of nonlinearity to use (&quot;gate&quot; or &quot;norm&quot;).</span>
<span class="sd">    - nonlinearity_scalars (Dict[int, Callable]): Nonlinearity for scalar channels.</span>
<span class="sd">    - nonlinearity_gates (Dict[int, Callable]): Nonlinearity for gate channels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">irreps_node_feats</span><span class="p">:</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">,</span>
        <span class="n">irreps_edge_attrs</span><span class="p">:</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">,</span>
        <span class="n">irreps_node_attrs</span><span class="p">:</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">,</span>
        <span class="n">irreps_edge_embed</span><span class="p">:</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">,</span>
        <span class="n">irreps_edge_feats</span><span class="p">:</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">,</span>
        <span class="n">use_kan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">radial_MLP</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nonlinearity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gate&quot;</span><span class="p">,</span>
        <span class="n">nonlinearity_scalars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="s2">&quot;ssp&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="s2">&quot;tanh&quot;</span><span class="p">},</span>
        <span class="n">nonlinearity_gates</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="s2">&quot;ssp&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="s2">&quot;abs&quot;</span><span class="p">},</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radial_MLP</span> <span class="o">=</span> <span class="n">radial_MLP</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_kan</span> <span class="o">=</span> <span class="n">use_kan</span>

        <span class="c1"># Assign irreps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irreps_node_feats</span> <span class="o">=</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">(</span><span class="n">irreps_node_feats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irreps_edge_attrs</span> <span class="o">=</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">(</span><span class="n">irreps_edge_attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irreps_edge_embed</span> <span class="o">=</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">(</span><span class="n">irreps_edge_embed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irreps_edge_feats</span> <span class="o">=</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">(</span><span class="n">irreps_edge_feats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irreps_node_attrs</span> <span class="o">=</span> <span class="n">o3</span><span class="o">.</span><span class="n">Irreps</span><span class="p">(</span><span class="n">irreps_node_attrs</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">nonlinearity_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="s2">&quot;norm&quot;</span><span class="p">),</span> <span class="s2">&quot;Invalid nonlinearity type.&quot;</span>

        <span class="c1"># Convert nonlinearity mappings</span>
        <span class="n">nonlinearity_scalars</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">nonlinearity_scalars</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">],</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">nonlinearity_scalars</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">nonlinearity_gates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">nonlinearity_gates</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">],</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">nonlinearity_gates</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="c1"># Linear layers for lifting node features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_up_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">irreps_node_feats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_up_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">irreps_node_feats</span><span class="p">)</span>

        <span class="c1"># TensorProduct layer for edge feature mixing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_tp</span> <span class="o">=</span> <span class="n">TensorProductWithMemoryOptimizationWithWeight</span><span class="p">(</span><span class="n">irreps_input_1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">irreps_node_feats</span><span class="p">,</span> 
                                                                      <span class="n">irreps_input_2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">irreps_edge_attrs</span><span class="p">,</span> 
                                                                      <span class="n">irreps_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">irreps_edge_feats</span><span class="p">,</span> 
                                                                      <span class="n">irreps_scalar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">irreps_edge_embed</span><span class="p">,</span> 
                                                                      <span class="n">radial_MLP</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">radial_MLP</span><span class="p">,</span> 
                                                                      <span class="n">use_kan</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_kan</span><span class="p">)</span>

<div class="viewcode-block" id="PairInteractionEmbeddingBlock.create_linear">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.create_linear">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irreps_in</span><span class="p">,</span> <span class="n">irreps_out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a linear layer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">o3</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
            <span class="n">irreps_in</span><span class="p">,</span> <span class="n">irreps_out</span> <span class="ow">or</span> <span class="n">irreps_in</span><span class="p">,</span> <span class="n">internal_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_weights</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PairInteractionEmbeddingBlock.create_tensor_product">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.create_tensor_product">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_tensor_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irreps_mid</span><span class="p">,</span> <span class="n">instructions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a TensorProduct layer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">o3</span><span class="o">.</span><span class="n">TensorProduct</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">irreps_node_feats</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">irreps_edge_attrs</span><span class="p">,</span>
            <span class="n">irreps_mid</span><span class="p">,</span>
            <span class="n">instructions</span><span class="o">=</span><span class="n">instructions</span><span class="p">,</span>
            <span class="n">shared_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">internal_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PairInteractionEmbeddingBlock.init_weight_generator">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.init_weight_generator">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">init_weight_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">weight_numel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize weight generator.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_kan</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">KAN</span><span class="p">([</span><span class="n">input_dim</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radial_MLP</span> <span class="o">+</span> <span class="p">[</span><span class="n">weight_numel</span><span class="p">],</span> <span class="n">grid_size</span><span class="o">=</span><span class="n">GRID_SIZE</span><span class="p">,</span> <span class="n">grid_range</span><span class="o">=</span><span class="n">GRID_RANGE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FullyConnectedNet</span><span class="p">(</span>
            <span class="p">[</span><span class="n">input_dim</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radial_MLP</span> <span class="o">+</span> <span class="p">[</span><span class="n">weight_numel</span><span class="p">],</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">silu</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PairInteractionEmbeddingBlock.forward">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.PairInteractionEmbeddingBlock.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Forward pass of the pair interaction block.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - data (Dict[str, torch.Tensor]): A dictionary containing the graph data.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - torch.Tensor: Updated edge features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">edge_src</span><span class="p">,</span> <span class="n">edge_dst</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">EDGE_INDEX_KEY</span><span class="p">]</span>
        <span class="n">node_feats</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">NODE_FEATURES_KEY</span><span class="p">]</span>
        <span class="n">edge_embed</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">EDGE_EMBEDDING_KEY</span><span class="p">]</span>
        <span class="n">edge_attributes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">EDGE_ATTRS_KEY</span><span class="p">]</span>
        
        <span class="n">node_feats_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_up_src</span><span class="p">(</span><span class="n">node_feats</span><span class="p">[</span><span class="n">edge_src</span><span class="p">])</span>
        <span class="n">node_feats_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_up_dst</span><span class="p">(</span><span class="n">node_feats</span><span class="p">[</span><span class="n">edge_dst</span><span class="p">])</span>

        <span class="c1"># Mixing node features for edge features</span>
        <span class="n">edge_feats_mix_tp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_tp</span><span class="p">(</span>
            <span class="n">node_feats_src</span> <span class="o">+</span> <span class="n">node_feats_dst</span><span class="p">,</span> <span class="n">edge_attributes</span><span class="p">,</span> <span class="n">edge_embed</span>
        <span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="n">AtomicDataDict</span><span class="o">.</span><span class="n">EDGE_FEATURES_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_feats_mix_tp</span>
        <span class="k">return</span> <span class="n">edge_feats_mix_tp</span></div>
</div>



<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Embedding layer which takes scalar nuclear charges Z and transforms </span>
<span class="sd">them to vectors of size num_features</span>
<span class="sd">&quot;&quot;&quot;</span>
<div class="viewcode-block" id="Embedding">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.Embedding">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Embedding</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">Zmax</span><span class="o">=</span><span class="mi">87</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Embedding</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_features</span> <span class="o">=</span> <span class="n">num_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zmax</span> <span class="o">=</span> <span class="n">Zmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s1">&#39;electron_config&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">electron_configurations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_parameter</span><span class="p">(</span><span class="s1">&#39;element_embedding&#39;</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">)))</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">config_linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_config</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>

<div class="viewcode-block" id="Embedding.reset_parameters">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.Embedding.reset_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_embedding</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">orthogonal_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_linear</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span></div>


<div class="viewcode-block" id="Embedding.forward">
<a class="viewcode-back" href="../../../api/model_components.html#HamGNN_v_2_1.nn.embeddings.Embedding.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_embedding</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embedding</span><span class="p">[</span><span class="n">Z</span><span class="p">]</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright HamGNN Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"></span>
    docs | v2.1 | en
    <span class="fa fa-caret-down"></span>
  </span>
  
  <div class="rst-other-versions">
    
    
    
    
    
    
    
    

    <hr>
    <dl>
      <dt>项目主页</dt>
      <dd>
        <a href="https://github.com/bud-primordium/HamGNN">
          <span class="fa fa-github"></span> GitHub
        </a>
      </dd>
    </dl>
  </div>
</div>

<style>
/* 自定义样式优化三维切换器 */
.rst-versions {
  font-size: 14px;
}

/* 让版本切换器更醒目 */
.rst-current-version {
  background-color: #2c3e50 !important;
  font-weight: bold !important;
  font-size: 15px !important;
  padding: 12px 24px !important;
}

.rst-current-version:hover {
  background-color: #34495e !important;
}

.rst-other-versions dl {
  margin-bottom: 16px;
}

.rst-other-versions dt {
  color: #55a5d9;
  font-weight: bold;
  margin-bottom: 8px;
}

.rst-other-versions dd {
  margin-left: 16px;
  margin-bottom: 4px;
}

.rst-other-versions dd.rtd-current-item a {
  font-weight: bold;
  color: #55a5d9;
}

.rst-other-versions hr {
  margin: 16px 0;
  border: none;
  border-top: 1px solid #444;
}
</style><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>